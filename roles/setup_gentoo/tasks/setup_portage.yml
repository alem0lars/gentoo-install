---

- name: Setup local portage repository (1/4)
  file:
    path:  /usr/local/portage/metadata
    state: directory
  tags: repository

- name: Setup local portage repository (2/4)
  template:
    src:  portage/local_repository/layout.conf.j2
    dest: /usr/local/portage/metadata/layout.conf
  tags: repository

- name: Setup local portage repository (3/4)
  template:
    src:  portage/local_repository/repo_name.j2
    dest: /usr/local/portage/repo_name
  tags: repository

- name: Setup local portage repository (4/4)
  command: chown -R portage:portage /usr/local/portage
  tags: repository
# Crossdev
# root #mkdir -p /usr/local/portage-crossdev/{profiles,metadata}
# root #echo 'crossdev' > /usr/local/portage-crossdev/profiles/repo_name
# root #echo 'masters = gentoo' > /usr/local/portage-crossdev/metadata/layout.conf
# root #chown -R portage:portage /usr/local/portage-crossdev
# If the main Portage tree is synchronized by using Git, or any other method with Manifest files that do not include checksums for ebuilds, prevent "masked by: corruption" errors with:

# FILE /usr/local/portage-crossdev/metadata/layout.conf
# masters = gentoo
# thin-manifests = true
# Then instruct Portage and crossdev to use this overlay:

- name: Update GCC version
 command: gcc-config 1 # TODO: Choose based on CHOST

- name: Update environment
  command: eselect env update
  tags:
    - environment

# Aggiungere l'utente
- command: useradd -m -G -s /bin/bash alem0lars

- name: fare passi di alem0lars/configs_book/gentoo/configuration/software/portage.md


# ------------------------------------------------------------------------------------

# TODO: check se son buoni: eclean-kernel diffmask flaggie install-mask portpeek smart-live-rebuild
# e in tal caso aggiungerli

- command: layman -o https://raw.github.com/alem0lars/apo/master/repositories.xml -f -a apo
